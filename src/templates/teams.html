{% extends "base.html" %}

{% block title %}Teams - Tournament Allocator{% endblock %}

{% block content %}
<h1>Team Management</h1>

{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        {% for category, message in messages %}
        <div class="alert alert-{{ category }}">
            {{ message }}
        </div>
        {% endfor %}
    {% endif %}
{% endwith %}

<section class="section">
    <h2>Add New Pool</h2>
    <form method="POST" class="inline-form">
        <input type="hidden" name="action" value="add_pool">
        <input type="text" name="pool_name" placeholder="Pool name (e.g., Pool A)" required>
        <input type="number" name="advance_count" value="2" min="1" max="10" style="width: 80px;" title="Teams advancing">
        <span class="help-inline">advance</span>
        <button type="submit" class="btn btn-primary">Add Pool</button>
    </form>
</section>

{% if pools %}
<section class="section">
    <h2>Pools & Teams</h2>
    
    <div class="pools-grid">
        {% for pool_name, pool_data in pools.items() %}
        <div class="pool-card">
            <div class="pool-header">
                <h3>{{ pool_name }}</h3>
                <form method="POST" class="inline" onsubmit="return confirm('Delete this pool and all its teams?');">
                    <input type="hidden" name="action" value="delete_pool">
                    <input type="hidden" name="pool_name" value="{{ pool_name }}">
                    <button type="submit" class="btn btn-danger btn-sm">Delete Pool</button>
                </form>
            </div>
            
            <div class="advance-setting">
                <form method="POST" class="inline-form">
                    <input type="hidden" name="action" value="update_advance">
                    <input type="hidden" name="pool_name" value="{{ pool_name }}">
                    <label>Top</label>
                    <input type="number" name="advance_count" value="{{ pool_data.advance }}" min="1" max="10" style="width: 60px;">
                    <label>advance</label>
                    <button type="submit" class="btn btn-sm btn-primary">Update</button>
                </form>
            </div>
            
            <form method="POST" class="add-team-form">
                <input type="hidden" name="action" value="add_team">
                <input type="hidden" name="pool_name" value="{{ pool_name }}">
                <input type="text" name="team_name" placeholder="Team name" required>
                <button type="submit" class="btn btn-success btn-sm">Add Team</button>
            </form>
            
            {% if pool_data.teams %}
            <ul class="team-list">
                {% for team in pool_data.teams %}
                <li>
                    <form method="POST" class="team-edit-form">
                        <input type="hidden" name="action" value="edit_team">
                        <input type="hidden" name="pool_name" value="{{ pool_name }}">
                        <input type="hidden" name="old_team_name" value="{{ team }}">
                        <input type="text" name="new_team_name" value="{{ team }}" class="team-name-input" required>
                        <button type="submit" class="btn btn-primary btn-xs team-save-btn" title="Save">✓</button>
                    </form>
                    <form method="POST" class="inline">
                        <input type="hidden" name="action" value="delete_team">
                        <input type="hidden" name="pool_name" value="{{ pool_name }}">
                        <input type="hidden" name="team_name" value="{{ team }}">
                        <button type="submit" class="btn btn-danger btn-xs">×</button>
                    </form>
                </li>
                {% endfor %}
            </ul>
            {% else %}
            <p class="empty-message">No teams in this pool yet.</p>
            {% endif %}
            
            <p class="pool-stats">
                {{ pool_data.teams|length }} team(s) • 
                {{ (pool_data.teams|length * (pool_data.teams|length - 1)) // 2 }} match(es) •
                Top {{ pool_data.advance }} advance
            </p>
        </div>
        {% endfor %}
    </div>
</section>
{% else %}
<div class="empty-state">
    <h2>No pools yet</h2>
    <p>Create a pool above to get started.</p>
</div>
{% endif %}
{% endblock %}
