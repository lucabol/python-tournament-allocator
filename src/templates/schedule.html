{% extends "base.html" %}

{% block title %}Schedule - Tournament Allocator{% endblock %}

{% block content %}
<h1>Tournament Schedule</h1>

<section class="section">
    <form method="POST" onsubmit="this.querySelector('.btn-with-spinner').classList.add('loading')">
        <button type="submit" class="btn btn-success btn-lg btn-with-spinner">
            <span>ðŸ”„ Generate Schedule</span>
            <span class="spinner"></span>
        </button>
    </form>
</section>

{% if error %}
<div class="alert alert-error">
    <strong>Error:</strong> {{ error }}
</div>
{% endif %}

{% if stats %}
<div class="stats-bar">
    <div class="stat">
        <span class="stat-value">{{ stats.total_matches }}</span>
        <span class="stat-label">Total Matches</span>
    </div>
    <div class="stat">
        <span class="stat-value success">{{ stats.scheduled_matches }}</span>
        <span class="stat-label">Scheduled</span>
    </div>
    {% if stats.unscheduled_matches > 0 %}
    <div class="stat">
        <span class="stat-value danger">{{ stats.unscheduled_matches }}</span>
        <span class="stat-label">Unscheduled</span>
    </div>
    {% endif %}
</div>
{% endif %}

{% if schedule %}
    {% for day, day_data in schedule.items() %}
    <section class="section day-section">
        <h2>{{ day }}</h2>
        
        {% set time_slots = day_data['_time_slots'] %}
        {% set courts = day_data.keys() | reject('equalto', '_time_slots') | list %}
        
        <div class="schedule-table-wrapper">
            <table class="schedule-table">
                <thead>
                    <tr>
                        <th class="time-col">Time</th>
                        {% for court_name in courts %}
                        <th>{{ court_name }}</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {% for time_slot in time_slots %}
                    <tr>
                        <td class="time-col">{{ time_slot }}</td>
                        {% for court_name in courts %}
                        <td>
                            {% if time_slot in day_data[court_name]['time_to_match'] %}
                                {% set match = day_data[court_name]['time_to_match'][time_slot] %}
                                <span class="match-teams">{{ match.teams[0] }} <span class="vs">vs</span> {{ match.teams[1] }}</span>
                            {% endif %}
                        </td>
                        {% endfor %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </section>
    {% endfor %}
{% elif not error %}
<div class="empty-state">
    <h2>No schedule generated yet</h2>
    <p>Click "Generate Schedule" to create the tournament schedule based on your teams, courts, and constraints.</p>
</div>
{% endif %}
{% endblock %}
