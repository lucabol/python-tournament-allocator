{% extends "base.html" %}

{% block title %}Tournaments - Tournament Allocator{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Tournament Management</h1>
</div>

{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        {% for category, message in messages %}
        <div class="alert alert-{{ category }}">
            {{ message }}
        </div>
        {% endfor %}
    {% endif %}
{% endwith %}

<section class="section">
    <h2>Create New Tournament</h2>
    <form method="POST" action="{{ url_for('api_create_tournament') }}" class="inline-form">
        <input type="text" name="name" placeholder="Tournament name" required>
        <button type="submit" class="btn btn-primary">Create</button>
    </form>
</section>

<section class="section">
    <h2>Your Tournaments</h2>
    {% if tournaments %}
    <table class="data-table">
        <thead>
            <tr>
                <th>Name</th>
                <th>Created</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for t in tournaments %}
            <tr class="{% if t.slug == active %}active-tournament{% endif %}">
                <td>
                    {{ t.name }}
                    {% if t.slug == active %} <span class="badge badge-active">Active</span>{% endif %}
                </td>
                <td>{{ t.created[:10] if t.created else 'â€”' }}</td>
                <td>
                    {% if t.slug != active %}
                    <form method="POST" action="{{ url_for('api_switch_tournament') }}" class="inline">
                        <input type="hidden" name="slug" value="{{ t.slug }}">
                        <button type="submit" class="btn btn-primary btn-sm">Switch</button>
                    </form>
                    {% endif %}
                    <form method="POST" action="{{ url_for('api_delete_tournament') }}" class="inline"
                          onsubmit="return confirm('Delete tournament &quot;{{ t.name }}&quot;? This cannot be undone.')">
                        <input type="hidden" name="slug" value="{{ t.slug }}">
                        <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div class="empty-state">
        <h2>No tournaments yet</h2>
        <p>Create one above to get started.</p>
    </div>
    {% endif %}
</section>

<section class="section">
    <h2>Backup & Restore</h2>
    <div class="actions-bar" style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
        <a href="{{ url_for('api_export_user') }}" class="btn btn-secondary btn-sm">ðŸ’¾ Export All Tournaments</a>
        <button onclick="document.getElementById('import-all-file').click()" class="btn btn-secondary btn-sm">ðŸ“‚ Import Tournaments</button>
    </div>
    <form id="import-all-form" method="POST" action="{{ url_for('api_import_user') }}" enctype="multipart/form-data" style="display:none">
        <input type="file" id="import-all-file" name="file" accept=".zip" onchange="confirmImport(this)">
    </form>
</section>

<script>
function confirmImport(input) {
    if (!input.files.length) return;
    if (confirm('This will import tournaments from the ZIP file. Existing tournaments with the same name will be overwritten. Continue?')) {
        document.getElementById('import-all-form').submit();
    } else {
        input.value = '';
    }
}
</script>
{% endblock %}
